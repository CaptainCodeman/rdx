{"version":3,"file":"store.js","sources":["../src/store.ts"],"sourcesContent":["import { stateEvent, dispatchEvent } from \"const\"\n\nexport type Action<P = any> = { type?: string, payload?: P }\n\nexport type Dispatch = <A extends Action>(action: A) => any\n\nexport type Reducer<S = any, A = Action> = (state: S, action: A) => S\n\nexport type StoreEvent = { action: Action }\n\nexport class Store<S> extends EventTarget {\n  constructor(public state: S, public reducer: Reducer<S>) {\n    super()\n    this.state = this.reducer(this.state, {})\n  }\n\n  dispatch(action: Action) {\n    const evt = new CustomEvent<StoreEvent>(dispatchEvent, {\n      cancelable: true,\n      detail: { action },\n    })\n\n    if (this.dispatchEvent(evt)) {\n      action = evt.detail.action\n      this.state = this.reducer(this.state, action)\n      this.dispatchEvent(new CustomEvent<StoreEvent>(stateEvent, {\n        detail: { action },\n      }))\n    }\n\n    return action\n  }\n}\n"],"names":["Store","EventTarget","[object Object]","state","reducer","super","this","action","evt","CustomEvent","dispatchEvent","cancelable","detail","stateEvent"],"mappings":"gDAUaA,UAAiBC,YAC5BC,YAAmBC,EAAiBC,GAClCC,QADiBC,WAAAH,EAAiBG,aAAAF,EAElCE,KAAKH,MAAQG,KAAKF,QAAQE,KAAKH,MAAO,IAGxCD,SAASK,GACP,MAAMC,EAAM,IAAIC,YAAwBC,EAAe,CACrDC,YAAY,EACZC,OAAQ,CAAEL,OAAAA,KAWZ,OARID,KAAKI,cAAcF,KACrBD,EAASC,EAAII,OAAOL,OACpBD,KAAKH,MAAQG,KAAKF,QAAQE,KAAKH,MAAOI,GACtCD,KAAKI,cAAc,IAAID,YAAwBI,EAAY,CACzDD,OAAQ,CAAEL,OAAAA,OAIPA"}